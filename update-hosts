#!/bin/bash -e
#
# pbrisbin 2012
#
###

die() { echo "error: $*" >&2; exit 1; }

(( $UID )) && die 'you must be root'
[[ -z "$HOSTNAME" ]] && die '$HOSTNAME not set'

site='http://someonewhocares.org/hosts/hosts'

lanips=( 
  'router::192.168.0.1'
  'blue::192.168.0.5'
  'xbox::192.168.0.6'
  'howard::192.168.0.7'
  'susan::192.168.0.8'
  'htpc::192.168.0.9'
  'pixma::192.168.0.15'
  'work::192.168.0.16'
)

cp -v /etc/hosts{,.bak}

{
  cat << EOF
#
# /etc/hosts: static lookup table for host names
#
# auto-generated by $(basename $0) on $(date -R)
#
###

#<ip-address>	<hostname.domain.org>	<hostname>
127.0.0.1	localhost.localdomain	localhost   $HOSTNAME
::1             localhost.localdomain   localhost   $HOSTNAME

EOF

  for entry in "${lanips[@]}"; do
    host="${entry%%::*}"
    ip="${entry##*::}"

    echo -e "$ip\t$host.localdomain\t$host"
  done

  cat << EOF

###
# The below is brought to you by Dan Pollock and can be found at
# http://someonewhocares.org/hosts/
#
# You are free to copy and distribute this file, as long the original 
# URL is included.
###
  
EOF

  wget -O - "$site" | grep -v 'local\|host' | grep '^127'
  echo

} > /etc/hosts.new

mv -v /etc/hosts.{new,bak}
rm -v /etc/hosts.bak
